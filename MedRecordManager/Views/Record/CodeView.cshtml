@model CodeChartVm

@section scripts{
    <script src="~/lib/printThis/printThis.js"></script>
    <script type="text/javascript">
        var IcdCodeGrid;
        var CptCodeGrid;
        var idcRenderer;
        var cptRenderer;
        var verbage = 'I attest that I am not changing the material in the medical chart, but updating the codes to accurately represent the procedures, diagnosis, and documentation provided in the medical record.” and clicking accept logs this attestation and who was the logged in user for those changes to the code list.'
        var id = $("#codeVisitId").val();

        idcRenderer = function (value, record, $cell, $displayEl, id) {
            var $editBtn = $('<i class="fa fa-pencil gj-cursor-pointer" data-key="' + id + '"></i>'),
                $cancelBtn = $('<i class="fa fa-undo gj-cursor-pointer" data-key="' + id + '"></i>').hide();
            $editBtn.on('click', function (e) {
                IcdCodeGrid.edit($(this).data('key'));
                $editBtn.hide();
                $cancelBtn.show();
            });
            $cancelBtn.on('click', function (e) {
                IcdCodeGrid.cancel($(this).data('key'));
                $editBtn.show();
                $cancelBtn.hide();
            });
            $displayEl.empty().append($editBtn).append($cancelBtn);
        }

        cptRenderer = function (value, record, $cell, $displayEl, id) {
            var $editBtn = $('<i class="fa fa-pencil gj-cursor-pointer" data-key="' + id + '"></i>'),
                $cancelBtn = $('<i class="fa fa-undo gj-cursor-pointer" data-key="' + id + '"></i>').hide();
            $editBtn.on('click', function (e) {
                CptCodeGrid.edit($(this).data('key'));
                $editBtn.hide();
                $cancelBtn.show();
            });
            $cancelBtn.on('click', function (e) {
                CptCodeGrid.cancel($(this).data('key'));
                $editBtn.show();
                $cancelBtn.hide();
            });
            $displayEl.empty().append($editBtn).append($cancelBtn);
        }

        $(document).ready(function () {
            IcdCodeGrid = $('#IcdCodeTable').grid({
                primaryKey: 'code',
                params: { visitId: id },
                inlineEditing: { mode: 'command', managementColumn: false },
                dataSource: '/Record/GetIcdCode',
                columns: [
                    { field: 'code', title: 'Code', editor: true },
                    { field: 'description', title: 'Description' },
                    { width: 56, renderer: idcRenderer },
                    { width: 100, tmpl: '<u class="gj-cursor-pointer"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></u>', events: { 'click': icdDelete } }
                ],
                pager: { limit: 10, sizes: [2, 5, 10, 20] },
            });

            CptCodeGrid = $('#CPTCodeTable').grid({
                primaryKey: 'codeName',
                params: { visitId: id },
                inlineEditing: { mode: 'command', managementColumn: false },
                dataSource: '/Record/GetCptCode',
                columns: [
                    { field: 'quantity', title: 'Quantity', editor: true },
                    { field: 'codeType', title: 'CPT Type' },
                    { field: 'codeName', title: 'Code', editor: true },
                    { field: 'modifier', title: 'Modifier', editor: true},
                    { field: 'shortDescription', title: 'Description' },
                    { field: 'description', hidden: true },
                    { width: 56, renderer: cptRenderer },
                    { width: 100, tmpl: '<u class="gj-cursor-pointer"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></u>', events: { 'click': icdDelete } }

                ],
                pager: { limit: 10, sizes: [2, 5, 10, 20] },
            });

            $(".viewer").zoomer();

            $("#btnPrint").click(function () {
                $("#chartviewer").printThis();
            });

            $("#btnSaveicd").click(function () { alert(verbage) });

            function icdDelete(e) {
                if (confirm('Are you sure to remove this row ' + e.data.id + '?')) {
                    IcdCodeGrid.removeRow(e.data.id);
                    IcdCodeGrid.reload({ visitId: id });
                }
            }

            if ($('#position').val() == 1) {
                $('#btnprevious').attr("disabled", "disabled")
            }
            else {
                $('#btnprevious').removeAttr("disabled")
            }

            if ($('#position').val() == @Model.Total) {
                $('#btnnext').attr("disabled", "disabled")
            }
            else {
                $('#btnnext').removeAttr("disabled")
            }
        });


    </script>
}

<div class="row top-buffer">
    @Html.HiddenFor(x => x.VisitId, new { id = "codeVisitId" })
    <input type="hidden" id="position" value=@Model.Position>
    <div class="col-lg-2">
        You are viewing @Model.Position of @Model.Total Records. VisitId : @Model.VisitId
    </div>
    <div class="col-lg-10">
        <div class="btn-toolbar" role="toolbar" aria-label="Toolbar with button groups">
            <div class="btn-group" role="group" aria-label="first group">
                @*<button type="button" class="btn btn-default" id="btnHold" @((Model.Position == 1) ? "disabled" : "") onclick="location.href='@Url.Action("LoadCode", "record")?skip= @(Model.Position-1)">Previous</button>
                    <button type="button" class="btn btn-default" id="btnHold"@((Model.Position == Model.Total) ? "disabled" :"") onclick="location.href='@Url.Action("LoadCode", "record")?skip=@(Model.Position+1)">next</button>*@
                @Html.ActionLink("Previous", "LoadCode", "Record", new { position = (Model.Position - 2) }, new { @class = "btn btn-default", id = "btnprevious" })
                @Html.ActionLink("Next", "LoadCode", "Record", new { position = Model.Position }, new { @class = "btn btn-default", id = "btnnext" })
            </div>

            <button type="button" class="btn btn-primary" id="btnHold">Hold</button>

            <a href="" class="btn btn-success" data-toggle="modal" data-target="#modalContactForm">Message</a>

            <button type="button" class="btn btn-warning">Save</button>

            @Html.ActionLink("Home", "review", "record", null, new { @class = "btn btn-link" })

        </div>
    </div>

</div>

<div class="row top-buffer">
    <div class="col-lg-6">
        <div class="panel panel-default">
            <div class="panel-heading"><h3>Patient Chart</h3></div>
            <div class="panel-body">
                <div class="btn-toolbar" role="toolbar" aria-label="Toolbar with button groups">
                    <div class="btn-group" role="group" aria-label="Second group">
                        <button type="button" class="btn btn-primary" id="btnPrint">Print</button>
                    </div>
                    <div class="btn-group" role="group" aria-label="Third group">
                        <button type="button" class="btn btn-warning" data-toggle="modal" data-target="#uploadModal">Replace</button>
                    </div>
                </div>
                <div class="viewer text-center" style="height:800px; width:700px;" id="chartviewer">
                    @{
                        var base64 = Convert.ToBase64String(Model.Chart.fileBinary);
                        var imgsrc = string.Format("data:image/jpeg;base64,{0}", base64);
                    }

                    <img src="@imgsrc" alt="" class="img-thumbnail img-fluid">

                </div>
            </div>
        </div>
    </div>
    <div class="col-lg-6">
        <div class="panel panel-default">
            <div class="panel-heading"><h3>Code Records</h3></div>
            <div class="panel-body">

                <div class="box box-danger">
                    <div class="box-header with-border">
                        <div class="col-lg-3">
                            <h3 class="box-title">CPTCode Records</h3>
                        </div>

                        <div class="col-lg-9 align-self-end">
                            <div class="row">
                                <div class="btn-toolbar" role="toolbar" aria-label="Toolbar with button groups">
                                    <div class="btn-group" role="group" aria-label="Third group">
                                        <button type="button" class="btn btn-warning" id="btnAdd" data-toggle="modal" data-target="#modalIcdCode">Add Row</button>
                                    </div>
                                    <div class="btn-group mr-2" role="group" aria-label="Second group">
                                        <button type="button" class="btn btn-primary" id="btnSaveicd">Save Changes</button>
                                    </div>
                                    <div class="btn-group mr-2" role="group" aria-label="First group">
                                        <button type="button" class="btn btn-success" onclick="undoIcd">Undo</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="box-body">
                        <table id="CPTCodeTable" class="table table-striped"></table>
                    </div>

                    <div class="box box-warning">
                        <div class="box-header with-border">
                            <div class="col-lg-3">
                                <h3 class="box-title">IcdCode Records</h3>
                            </div>

                            <div class="col-lg-9 align-self-end">
                                <div class="row">
                                    <div class="btn-toolbar" role="toolbar" aria-label="Toolbar with button groups">
                                        <div class="btn-group" role="group" aria-label="Third group">
                                            <button type="button" class="btn btn-warning" id="btnAdd" data-toggle="modal" data-target="#modalIcdCode">Add Row</button>
                                        </div>
                                        <div class="btn-group mr-2" role="group" aria-label="Second group">
                                            <button type="button" class="btn btn-primary" id="btnSaveicd">Save Changes</button>
                                        </div>
                                        <div class="btn-group mr-2" role="group" aria-label="First group">
                                            <button type="button" class="btn btn-success" onclick="undoIcd">Undo</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="box-body">
                            <div class="table-responsive">
                                <table id="IcdCodeTable" class="table table-striped"></table>
                            </div>
                        </div>
                    </div>



                </div>

            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="modalContactForm" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
     aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header text-center">
                <h4 class="modal-title w-100 font-weight-bold">Message Pysican</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body mx-3">
                <div class="md-form mb-5">
                    <i class="fas fa-user prefix grey-text"></i>
                    <input type="text" id="form34" class="form-control validate">
                    <label data-error="wrong" data-success="right" for="form34">Your name</label>
                </div>

                <div class="md-form mb-5">
                    <i class="fas fa-envelope prefix grey-text"></i>
                    <input type="email" id="form29" class="form-control validate">
                    <label data-error="wrong" data-success="right" for="form29">Your email</label>
                </div>

                <div class="md-form mb-5">
                    <i class="fas fa-tag prefix grey-text"></i>
                    <input type="text" id="form32" class="form-control validate">
                    <label data-error="wrong" data-success="right" for="form32">Subject</label>
                </div>

                <div class="md-form">
                    <i class="fas fa-pencil prefix grey-text"></i>
                    <textarea type="text" id="form8" class="md-textarea form-control" rows="4"></textarea>
                    <label data-error="wrong" data-success="right" for="form8">Your message</label>
                </div>

            </div>
            <div class="modal-footer d-flex justify-content-center">
                <button class="btn btn-unique">Send <i class="fas fa-paper-plane-o ml-1"></i></button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="modalIcdCode" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
     aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header text-center">
                <h4 class="modal-title w-100 font-weight-bold">Add Icd Code Record</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body mx-3">
                <div class="md-form mb-5">
                    <i class="fas fa-user prefix grey-text"></i>
                    <input type="text" id="form34" class="form-control validate">
                    <label data-error="wrong" data-success="right" for="form34">Code name</label>
                </div>

                <div class="md-form mb-5">
                    <i class="fas fa-envelope prefix grey-text"></i>
                    <input type="email" id="form29" class="form-control validate">
                    <label data-error="wrong" data-success="right" for="form29">Modifier</label>
                </div>

                <div class="md-form mb-5">
                    <i class="fas fa-tag prefix grey-text"></i>
                    <input type="text" id="form32" class="form-control validate">
                    <label data-error="wrong" data-success="right" for="form32">Quantity</label>
                </div>

            </div>
            <div class="modal-footer d-flex justify-content-center">
                <button class="btn btn-unique">Add<i class="fas fa-paper-plane-o ml-1"></i></button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="modalcptCode" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
     aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header text-center">
                <h4 class="modal-title w-100 font-weight-bold">Add CPT Code Record</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body mx-3">
                <div class="md-form mb-5">
                    <i class="fas fa-user prefix grey-text"></i>
                    <input type="text" id="form34" class="form-control validate">
                    <label data-error="wrong" data-success="right" for="form34">Code name</label>
                </div>

                <div class="md-form mb-5">
                    <i class="fas fa-envelope prefix grey-text"></i>
                    <input type="email" id="form29" class="form-control validate">
                    <label data-error="wrong" data-success="right" for="form29">Modifier</label>
                </div>

                <div class="md-form mb-5">
                    <i class="fas fa-tag prefix grey-text"></i>
                    <input type="text" id="form32" class="form-control validate">
                    <label data-error="wrong" data-success="right" for="form32">Quantity</label>
                </div>

            </div>
            <div class="modal-footer d-flex justify-content-center">
                <button class="btn btn-unique">Add<i class="fas fa-paper-plane-o ml-1"></i></button>
            </div>
        </div>
    </div>
</div>

<!-- Modal -->
<div id="uploadModal" class="modal fade" role="dialog">
    <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">File upload form</h4>
            </div>
            <div class="modal-body">
                <!-- Form -->
                <form method='post' action='' enctype="multipart/form-data">
                    Select file : <input type='file' name='file' id='file' class='form-control'><br>
                    <input type='button' class='btn btn-info' value='Upload' id='upload'>
                </form>

                <!-- Preview-->
                <div id='preview'></div>
            </div>

        </div>

    </div>
</div>